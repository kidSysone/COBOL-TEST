概要
- [環境部での設定](#環境部での設定)
- [データ部での設定](#データ部での設定)
- [手続き部での操作](#手続き部での操作)
- [入力・出力例](#入力出力例)
***
## 環境部での設定
* `INPUT-OUTPUT SECTION`: ファイル定義セクション
* `SELECT 【***】 ASSIGN TO ''`: どういう風にファイルを呼ぶか指定（入力か出力かなど）
  * `【***】` との内容はのちのデータ部にて詳細を指定する
  * `ASSIGN TO 'LIST.csv'` -> この場合、binファイルがあるフォルダから該当名前のファイルを探す 。**実際のOS上のファイルパスに対応づける**
  * `ASSIGN TO 'C:\vs-workspaces\Cobol-Test\input\LIST.csv'` -> フォルダ指定
  * `ORGANIZATION IS LINE SEQUENTIAL`: データの区切り形式を指定（改行）
  * `STATUS IN-FILE-STATUS`: 行単位のテキストファイル形式で扱う

```Cobol
ENVIRONMENT DIVISION.        *> 実行環境に関する設定を記述する区分
INPUT-OUTPUT SECTION.        *> 入出力に関する設定を書くところ
  FILE-CONTROL.              *> ファイルの制御情報を定義
    SELECT OUT-FILE ASSIGN TO 'out.txt'  *> OUT-FILE を OS 上の 'out.txt' に結びつける
      ORGANIZATION IS LINE SEQUENTIAL.  *> 行単位のテキストファイル形式で扱う
```

## データ部での設定
* `FILE SECTION`: ファイル定義セクション
* FD(File Description)、`【***】`ファイルに関するデータ定義
  * その下に置く変数は【レコードの形】を定義するもの
```Cobol
DATA DIVISION.               *> データ領域を定義する区分
FILE SECTION.                *> ファイルに関するデータ定義
FD OUT-FILE.                 *> OUT-FILE のレコードフォーマットを定義開始
  01 OUT-FILE-REC PIC 99.    *> OUT-FILE に書き込む 2 桁数字のレコード
```
1. テキストファイル（LINE SEQUENTIAL）
  * レコード (RECORD) → ファイルの1行ぶん（今回なら200文字）
  * ブロック (BLOCK) → そのレコードをいくつかまとめて「まとめ読み・まとめ書き」する単位 
    * **基本0と指定すればいい** -> OS に任せて最適なブロックサイズで読み書きされる
  * RECORDING MODE → どうやって物理的に保存するかを指定
    * F、Fixed-length。固定長レコード。Windows/Linux でも文字数が固定
    * V、Variable-length。可変長レコード。長さ情報が付くため、OS 間で扱いに注意
    * U、Undefined / Unformatted。未定義。バイナリデータや特殊なフォーマットを扱う場合に使うことがある

```Cobol
FD IN-FILE
   RECORD CONTAINS 200 CHARACTERS *> 1 行分（レコード）の長さが 200 文字
   BLOCK CONTAINS 0 RECORDS *> ブロックサイズは 0（システムにお任せ）
   RECORDING MODE IS F. *> レコード記録方式は F（Fixed 固定長）、必ず 200 文字固定
01 IN-REC PIC X(200).     *> ファイル1行のレコード構造
```


## 手続き部での操作
* ファイルのopen/close(指定したいFDファイル名)
* OPEN / CLOSE / READ / WRITE / REWRITE の順で書くと、流れが見えやすい
  * OPEN OUTPUT OUT-FILE.
  * CLOSE OUT-FILE.

```Cobol
PROCEDURE DIVISION.
    OPEN INPUT IN-FILE
         OUTPUT OUT-FILE

    PERFORM UNTIL EOF
        READ IN-FILE INTO IN-REC
            AT END MOVE 'Y' TO EOF-FLAG
        END-READ

        WRITE OUT-REC FROM IN-REC
    END-PERFORM

    CLOSE IN-FILE OUT-FILE     *> 同時に書くことも可
    STOP RUN.
```

## 入力・出力例
```Cobol
       IDENTIFICATION DIVISION.
       PROGRAM-ID. TESTFILE.

       ENVIRONMENT DIVISION.
      *******************************************************
      *> 環境部、ファイルコントロールセクション（入力ファイル）
      *> ファイル名：in.txt
      *> ファイル組織：LINE SEQUENTIAL（行単位）
      *> ファイルステータス：IN-FILE-STATUS でコントロール（WORKING-STORAGE SECTION）
      *******************************************************
       INPUT-OUTPUT SECTION.
         FILE-CONTROL.
           SELECT IN-FILE ASSIGN TO 'in.txt'
             ORGANIZATION IS LINE SEQUENTIAL
             STATUS IN-FILE-STATUS. 

      *******************************************************
      *> 環境部、ファイルコントロールセクション（出力ファイル）
      *> ファイル名：out.txt
      *> ファイル組織：LINE SEQUENTIAL（行単位）
      *******************************************************
           SELECT OUT-FILE ASSIGN TO 'out.txt'
             ORGANIZATION IS LINE SEQUENTIAL.
       
       DATA DIVISION.
      *******************************************************
      *> データ部、ファイル定義セクション（入力ファイル）
      *> レコード構造：20文字の文字列
      *******************************************************
       FILE SECTION.   *> ファイルの中身のレコード構造を定義
       FD IN-FILE.
         01 IN-FILE-REC PIC X(20).

      *******************************************************
      *> データ部、ファイル定義セクション（出力ファイル）
      *> レコード構造：2桁の数値
      *******************************************************
       FD OUT-FILE.
         01 OUT-FILE-REC PIC 99.

      *******************************************************
      *> データ部、ワーキングストレージセクション
      *> ファイルステータス用の変数定義: IN-FILE-STATUS
      *******************************************************
       WORKING-STORAGE SECTION.
         01 IN-FILE-STATUS PIC XX. *> ファイルステータス用の変数
         01 LINE-COUNT PIC 99 VALUE 0.

       PROCEDURE DIVISION.
       MAIN SECTION.
      *******************************************************
      *> ファイル入力処理
      *> 流れ：open -> read -> close
      *******************************************************
           OPEN INPUT IN-FILE.
           PERFORM UNTIL IN-FILE-STATUS NOT = "00"
             READ IN-FILE
               AT END *> 読むものがなくなった場合（EOF）
                 DISPLAY "CONTENT: end / " IN-FILE-STATUS
                 DISPLAY "-- END --"
               NOT AT END *> 読み込み成功した場合
                 DISPLAY "CONTENT: " IN-FILE-REC " / " IN-FILE-STATUS
             END-READ

           END-PERFORM.
           CLOSE IN-FILE.

      *******************************************************
      *> ファイル出力処理
      *> 流れ：open -> write -> close
      *******************************************************
           OPEN OUTPUT OUT-FILE.
           PERFORM 10 TIMES
               ADD 1 TO LINE-COUNT
               MOVE LINE-COUNT TO OUT-FILE-REC  *> カウンタの値をファイル用レコードにセット
               WRITE OUT-FILE-REC   *> レコードをファイル (out.txt) に書き込む
               DISPLAY OUT-FILE-REC
           END-PERFORM
            
           CLOSE OUT-FILE.
            
           STOP RUN.

```